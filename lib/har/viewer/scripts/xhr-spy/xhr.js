require.def("xhr-spy/xhr",["core/lib"],function(i){function n(){this.requestHeaders=[];this.responseHeaders=[]}var t=function(a){function k(){for(var b in a)try{var c=a[b];i.isFunction(c)||(f[b]=c)}catch(e){}}function o(){for(var b in f)try{var c=f[b];a[b]||(a[b]=c)}catch(e){}}function u(){d.logRow=d.log();i.setClass(d.logRow,"loading")}function p(){d.response.status=a.status;d.response.statusText=a.statusText;(new Date).getTime();var b=a.status==200;v(a,d);setTimeout(function(){var c=a.responseText;
d.response.content.text=c;d.response.content.size=c;d.response.bodySize=c?c.length:0;i.removeClass(d.logRow,"loading");b||i.setClass(d.logRow,"error")},200);d.loaded=true;k()}function v(b,c){b=(b=b.getAllResponseHeaders())?b.split(/[\n\r]/):[];for(var e=/^(\S+):\s*(.*)/,g=0,l=b.length;g<l;g++){var j=b[g].match(e);if(j){var q=j[1];j=j[2];if(q=="Content-Type")c.response.mimeType=j;c.response.headers.push({name:[q],value:[j]})}}}function r(){f.readyState=a.readyState;if(a.readyState==4){p();a.onreadystatechange=
function(){}}f.onreadystatechange()}a=a;var d=new n,f=this;this.readyState=0;this.onreadystatechange=function(){};this.open=function(b,c,e,g,l){k();d.request.method=b;d.request.url=c;d.async=e;d.request.queryString=i.parseURLParams(c);if(!$.browser.msie&&e)a.onreadystatechange=r;typeof a.open.apply!="undefined"?a.open.apply(a,arguments):a.open(b,c,e,g,l);if($.browser.msie&&e)a.onreadystatechange=r};this.send=function(b){d.request.postData.text=b;d.timings.send=(new Date).getTime();o();try{a.send(b)}catch(c){throw c;
}finally{u();if(!d.async){f.readyState=a.readyState;p()}}};this.setRequestHeader=function(b,c){d.requestHeaders.push({name:[b],value:[c]});return a.setRequestHeader(b,c)};this.getResponseHeader=function(b){return a.getResponseHeader(b)};this.getAllResponseHeaders=function(){return a.getAllResponseHeaders()};this.abort=function(){return a.abort()};var w=a.open&&typeof a.open.apply!="undefined";for(var h in a)if(h!="onreadystatechange")try{var s=a[h];if(i.isFunction(s)){if(typeof f[h]=="undefined")this[h]=
w?function(){return a[h].apply(a,arguments)}:function(b,c,e,g,l){return a[h](b,c,e,g,l)}}else this[h]=s}catch(y){}return this},m=window.parent;if(/msie 6/i.test(navigator.appVersion))m.ActiveXObject=function(a){try{var k=new m._ActiveXObject(a);return" MSXML2.XMLHTTP.5.0 MSXML2.XMLHTTP.4.0 MSXML2.XMLHTTP.3.0 MSXML2.XMLHTTP Microsoft.XMLHTTP ".indexOf(" "+a+" ")!=-1?new t(k):k}catch(o){}};else{var x=m.XMLHttpRequest;m.XMLHttpRequest=function(){return new t(new x)}}n.prototype={async:null,href:null,
loaded:false,logRow:null,responseText:null,requestHeaders:null,responseHeaders:null,sourceLink:null,response:{headers:[],content:{text:""}},request:{url:"",method:"",bodySize:0,headers:[],postData:{}},timings:{dns:-1,connect:-1,blocked:-1,send:-1,wait:-1,receive:-1,ssl:-1,comment:-1,connect:-1},getURL:function(){return this.href},log:function(){}};return n});